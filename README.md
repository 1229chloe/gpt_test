Codex 요청용 STEP8 작업지시서 (최종 상세본)

⸻

■ 1. 개요 및 기본 요구

이 작업지시서는 제조방법변경 신청양식_empty_.docx 파일을 템플릿으로 하여,
Streamlit 앱의 STEP8에서 자동완성된 제조방법변경 신청양식을
title_key별로 페이징하여 화면에 출력하고,
자동입력 및 PDF/출력 기능을 구현하기 위한 명확한 기준과 요구사항을 정리한 것입니다.

⸻

■ 2. 템플릿 파일 및 입력 데이터

2-1. 템플릿 파일
	•	반드시 파일명 제조방법변경 신청양식_empty_.docx 를 그대로 사용할 것
	•	이 파일은 저장소 루트에 항상 존재하며,
외부 라이브러리, 한글/워드 설치, 서버 등 추가적 환경 의존은 절대 없이
python-docx만으로 조작 및 생성이 가능해야 함

2-2. 입력 데이터
2-2. 입력 데이터
	•	자동 입력 데이터는 Step 7의 결과값을 기반으로 함
	•	Step 7에서 이미 각 title_key별로
	•	보고유형, 필요서류, 충족조건 등
	•	사용자가 입력·선택한 값을
	•	딕셔너리·리스트 등 구조화된 형태로 보유

⸻

■ 3. 자동 입력/매핑 상세 규칙 (필드별 설명)

첨부된 "제조방법변경 신청양식_filled.docx"에 있는 자연어 설명 및
Step 7 코드 내 실제 title_key별 데이터 구조를 종합하여
각 칸에 자동으로 어떤 값이 매핑되는지 구체적으로 명시합니다.

3-1. [기본 정보 표]
칸 명칭	입력방식(자동입력 규칙/키값)
신청인 성명	무조건 공란 (자동입력하지 않음, 사용자가 따로 입력하지 않는 한 빈칸으로 둠)
제조소(영업소) 명칭	무조건 공란 (자동입력하지 않음)
변경신청 제품명	무조건 공란 (자동입력하지 않음)

3-2. [변경유형/신청유형]
[변경유형]
	•	입력 데이터:
	•	해당 title_key의 “title_text” 값 전체
(줄바꿈 포함, 예: ‘3.2.S.2 제조\n3. 원료의약품 제조 공정의 변경’)
	•	구현 방식:
	•	Step 7에서 페이징할 때, 해당 title_key의 row에서
"title_text" 값(줄바꿈 포함)을 그대로 사용

⸻

[신청유형]
	•	입력 데이터:
	•	Step7에서 title_key별로 저장된
"output_1_tag" 값 (예: “Cmin”, “AR” 등, 코드상에서는 row[“output_1_tag”])
	•	구현 방식:
	•	Step 7 결과(visible_results 등)에서 해당 title_key의 output_1_tag를 자동입력
	•	값이 없을 경우 공란

3-3. [충족조건 표]
행 자동생성 및 데이터 채움 규칙:
	1.	모든 충족조건은 step6_items에서 가져온다.
	2.	해당 title_key의 모든 requirement(예: “s2_3_req_1” 등) 리스트를 반복
	3.	각 requirement별로 아래처럼 행을 채운다:
	•	조건: 해당 requirement에 해당하는 질문 텍스트(예: requirement[“requirement”])
	•	충족여부:
	•	step6_selections에서 사용자가 “충족” 선택시 → ‘○’
	•	“미충족” 선택시 → ‘×’
	•	비고: (추가 정보 있으면), 기본은 공란
	•	구현 방식:
	•	step6_items[title_key][“requirements”]에서 키와 requirement 텍스트 모두 반복하여
	•	step6_selections의 값(충족/미충족)으로 OX 변환해서 자동 채움

3-4. [필요서류 표]
	•	행 자동생성 및 데이터 채움 규칙:
	1.	Step7에서 해당 title_key의 "output_2_text" 값(=필요서류는 다음과 같습니다.~ 이하)
	2.	이 값은 줄바꿈 문자(\n)로 여러 서류가 한 셀에 묶여 있음
	3.	“필요서류는 다음과 같습니다.” 이후 각 줄을 개별 항목(행)으로 분리
	4.	각 줄마다:
	•	서류명: 해당 줄의 텍스트 전체
	•	구비여부/해당페이지: 기본은 공란 (해당 값이 없으므로 비워둠)
	•	구현 방식:
	•	output_2_text에서 “필요서류는 다음과 같습니다.” 이후 줄바꿈(\n)으로 split
	•	각 줄을 필요서류명으로 사용, 구비여부/해당페이지는 빈칸

3-5. [빈칸(BLANK) 및 기타]
	•	“BLANK”로 표시된 모든 칸은 빈칸 그대로 유지
(즉, 임의로 ‘없음’ 등 표기하지 말고 그대로 공란)

⸻

■ 4. UI/UX 및 버튼/페이징 동작

4-1. title_key별 페이징
	•	Step 7에서 도출된 모든 title_key를
Step 8에서 각각의 별도 페이지로 표시
	•	각 페이지에는 해당 title_key에 대한 자동완성된 양식 1개만 표시
•	Step 7에서 추출된 모든 title_key별로 Step 8 페이지가 생성됨(동적 페이지 수)
	•	각 페이지마다:
	•	상단 : PDF 파일 생성하기 (다운로드), 출력하기 (print 연결)
	•	중앙: 해당 title_key의 자동채움된 신청양식 미리보기
	•	하단: 이전 단계로, 다음 단계로, 한 페이지 앞으로/뒤로
	•	단, Step 8이 마지막이므로 마지막 페이지에서는 ‘다음 단계로’ 버튼 비활성화
4-2. 버튼 구성
	•	상단
	•	PDF 파일 생성하기:
	•	현재 화면에 표시된(=현재 title_key) 양식을 PDF 파일로 저장하여 다운로드
	•	PDF 변환은 Streamlit에서만 동작(외부 의존X)
	•	출력하기:
	•	브라우저 인쇄 기능(웹 표준 print)로 바로 연결
	•	하단
	•	이전 단계로: Step 7로 이동
	•	다음 단계로: 다음 title_key로 이동 (마지막 페이지에서는 비활성화)
	•	한 페이지 앞으로/뒤로: title_key 페이징(좌우 이동)
	•	Step 8이 마지막 단계이므로, 마지막 페이지에서 더 이상의 단계 이동(=Step 9)은 제공하지 않음

4-3. 페이지 전환
	•	title_key별로 페이지가 자동 생성되고, 각 title_key마다
	•	자동 입력/채움된 양식만 표시
	•	사용자는 좌우 페이지 이동 및 PDF 저장/출력 기능만 수행

⸻

■ 5. PDF/출력 기능
	•	외부 프로그램, MS워드, 한글 등 어떤 환경 의존 없이 Streamlit 내에서 바로 docx→pdf 또는 
HTML→pdf 방식 활용 python-docx 단독 처리
	•	PDF 변환이 필요하면 Streamlit 내장(print-to-pdf, HTML2PDF 등) 사용
	•	브라우저 print는 window.print() 등 표준 print로 직접 연결
	•	Step 8에서 PDF 생성을 위해 reportlab 라이브러리를 사용합니다. requirements.txt에 명시된 reportlab을 설치해야 합니다.
        •       한글 PDF 출력을 위해 `fonts/NotoSansKR-Regular.ttf` 폰트 파일이 함께 제공됩니다.
        •       폰트 등록 실패 시 Streamlit 경고 후 기본 폰트로 계속 실행됩니다.

⸻

■ 6. 예외 처리 및 유의사항
	•	템플릿 docx 파일(제조방법변경 신청양식_empty_.docx)이 없으면 동작 즉시 중단, 오류 안내
	•	자동 입력값이 없는 칸/필드는 반드시 빈칸으로 두고, 임의의 값/기호 삽입 금지
	•	생성되는 모든 문서는 title_key별로 1:1 매칭되어 개별 관리됨
	•	표, 행은 입력값 개수에 따라 자동으로 생성/확장

⸻
7. 작업 예시용 샘플 설명(코덱스 참고용)
	•	예를 들어 title_key “s2_3”에서
	•	변경유형 = step7_rows에서 row[“title_text”]
	•	신청유형 = row[“output_1_tag”]
	•	충족조건 표 = step6_items[“s2_3”][“requirements”] 반복,
각 requirement[“requirement”] 및 step6_selections[requirement_key] 기준으로 OX 표기
	•	필요서류 = row[“output_2_text”]에서 “필요서류는 다음과 같습니다.” 이후 줄별로 분할해 한 줄씩 행 생성
	•	모든 입력값 없으면 빈칸


[summary]

“이 작업지시서는 Streamlit 기반의 STEP8 페이지를 구성하며,
첨부된 워드 템플릿(제조방법변경 신청양식_empty_.docx)을 기반으로
Step 7에서 산출된 title_key별 결과값을 해당 양식의 각 칸/표/행에 자동으로 채워
title_key별로 페이지화하여 사용자에게 출력, PDF 저장, 인쇄 기능을 제공합니다.
표/리스트는 결과값 개수만큼 동적으로 생성, 빈칸은 입력값이 없으면 그대로 유지하며
모든 구현은 python-docx/Streamlit 단독으로 동작해야 합니다.
Step 8이 마지막이므로, 이후 단계 이동은 없고,마지막 페이지의 다음 단계 버튼은 비활성화되어야 합니다.”
